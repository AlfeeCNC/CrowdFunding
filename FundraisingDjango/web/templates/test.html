{% extends  'base.html' %}
{% block main %}
<main>
    <section class="py-5 text-center container bg-light">
        <div class="row py-lg-5">
            <div class="col-lg-6 col-md-8 mx-auto">
                <h1 class="fw-light">建立新的募資提案</h1>
            </div>
        </div>
    </section>
    <section class="my-5 py-3">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-10">
                    <div class="alert alert-info hidden mb-4" role="alert" id="balance-alert">
                        您持有的平台幣低於發行計畫之手續費，請先儲值平台幣。
                    </div>
                    <div class="alert alert-info hidden mb-4" role="alert" id="wallet-alert">
                        請先連結您的Metamask。
                        <button class="btn btn-outline-dark" id="connect-metamask-btn">連結Metamask</button>
                    </div>
                    <form method="post" id="create-plan-form">
                        <div class="row g-3 mb-3">
                            <div class="col-sm-7">
                                <div class="mb-3">
                                    <label for="fundraising_period" class="form-label">計畫募資期間</label>
                                    <div class="row g-3 align-items-center">
                                        <div class="col-auto">
                                            <label for="fundraising_start_date" class="col-form-label">起始日</label>
                                        </div>
                                        <div class="col-auto">
                                            <input type="date" class="w-100 form-control" id="fundraising_start_date"
                                                name="fundraising_start_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <button class="w-100 btn btn-primary btn-lg" type="submit">送出</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</main>


<!-- Loading -->
<div id="overlay-loading">
    <img src="/static/Spin.gif" alt="">
</div>
<script src='/static/js/index.js?{% now "U" %}'></script>
<script>
    $("#create-plan-form").on('submit', function (e) {
        e.preventDefault()
        /*
            如果865夠發文
            1. 取得資料: (1)錢包地址 (2)表單資料
            2. 發送至後端: 
                (1) 更新用戶865數量
                (2) 呼叫合約，發erc721，取得721 plan token id & etherscan url 
                (3) 721資訊及計畫資訊紀錄至MySQL
            3. 顯示成功or失敗modal視窗
            否則
            跳出modal引導至購買頁面
        */
        var formData = new FormData(this);
        $.ajax({
            method: "POST",
            url: "test",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "json"
        }).done(function (res) {
            console.log()
        });

    });
</script>

{% endblock %}